/*
 * tinySelect ( http://mcfizh.github.io/tinySelect/ )
 *
 * Licensed under MIT license.
 *
 * @version 1.0.6
 * @author Pekka Harjam√§ki
 */
!function(i){"use strict";var e={init:function(t,e){t.data("tinySelectObj",this),this.config=i.extend({showSearch:!0,searchCaseSensitive:!0,txtLoading:"Loading...",txtAjaxFailure:"Error...",dataUrl:null,dataParser:null},e),this.state={container:null,selectBox:null,itemContainer:null,searchContainer:null,searchBox:null,$el:null,open:!1,ajaxPending:!1,selectedValue:-1,originalItemData:[],filteredItemData:[]},this.readSelect(t),this.createSelect(t)},createSelect:function(t){var e;this.state.container=i("<div></div>").addClass("tinyselect").css({width:t.css("width")}),(e=t.attr("id"))&&0<e.length&&this.state.container.attr("id",e+"_ts"),this.state.selectBox=i("<div></div>").addClass("selectbox").on("click",{self:this},this.onSelectBoxClicked),this.state.container.append(this.state.selectBox),this.state.dropdown=i("<div></div>").addClass("dropdown").hide(),this.state.container.append(this.state.dropdown),this.config.showSearch&&this.createSearch(this.state.dropdown),this.state.itemContainer=i("<ul></ul>").addClass("itemcontainer"),this.state.dropdown.append(this.state.itemContainer),this.createItems(),t.hide().after(this.state.container),this.state.$el=t,i(document).on("click",{self:this},this.onDocumentClicked)},createItems:function(t){var e,a;for(this.state.itemContainer.empty(),e=0;e<this.state.filteredItemData.length;e++){a=this.state.filteredItemData[e];var s=i("<li></li>").text(a.text).addClass("item").attr("data-value",a.val);a.val==this.state.selectedValue&&(this.state.selectBox.html(a.text),s.addClass("selected")),s.on("click",{self:this},this.onSelectLiClicked),this.state.itemContainer.append(s)}},createSearch:function(t){this.state.searchContainer=i("<div></div>").addClass("searchcontainer"),this.state.searchBox=i("<input type='text'></input>").addClass("searchbox").on("click",function(t){t.stopPropagation()}).on("keyup",{self:this},this.onSearchKeyPress),this.state.searchContainer.append(i("<span class='searchicon'></span>")),this.state.searchContainer.append(this.state.searchBox),this.state.dropdown.append(this.state.searchContainer)},readSelect:function(t){var a=this;t.find("option").each(function(t){var e=i(this);a.state.originalItemData.push({val:e.val(),text:e.text()})}),this.state.filteredItemData=this.state.originalItemData,this.state.selectedValue=t.val()},setAjaxIndicator:function(t){this.state.ajaxPending=!0,this.state.itemContainer.empty(),null!==this.state.searchContainer&&this.state.searchContainer.hide();var e=i("<li></li>");t?e.text(this.config.txtAjaxFailure).addClass("loaderrorindicator"):e.text(this.config.txtLoading).addClass("loadindicator"),this.state.itemContainer.append(e)},onDocumentClicked:function(t){var e=t.data.self;e.state.open&&e.onSelectBoxClicked(t)},onSearchKeyPress:function(t){var e=t.data.self,a=i(t.currentTarget).val();e.config.searchCaseSensitive||(a=a.toLowerCase()),0===a.length?e.state.filteredItemData=e.state.originalItemData:e.state.filteredItemData=e.state.originalItemData.filter(function(t){return e.config.searchCaseSensitive?0<=t.text.indexOf(a):0<=t.text.toLowerCase().indexOf(a)}),e.createItems()},onSelectBoxClicked:function(t){var e=t.data.self;if(!e.state.dropdown.is(":animated")){if(e.state.open)return e.state.open=!1,e.state.selectBox.removeClass("open"),void e.state.dropdown.slideUp(100);null!==e.config.dataUrl&&(e.setAjaxIndicator(!1),i.ajax({url:e.config.dataUrl,dataType:"json",type:"GET"}).done(function(t){e.onAjaxLoadSuccess(e,t)}).fail(function(t){e.onAjaxLoadError(e,t)})),e.state.open=!0,e.state.selectBox.addClass("open"),e.state.dropdown.slideDown(100)}},onAjaxLoadSuccess:function(e,t){e.state.ajaxPending=!1,null!==e.config.dataParser&&(t=e.config.dataParser(t,e.state.selectedValue)),e.state.$el.empty(),t.forEach(function(t){t.selected&&(e.state.selectedValue=t.val),e.state.$el.append(i("<option></option>").text(t.text).val(t.val))}),e.state.$el.val(e.state.selectedValue),e.state.originalItemData=t,e.state.filteredItemData=t,null!==this.state.searchContainer&&this.state.searchContainer.show(),e.createItems()},onAjaxLoadError:function(t,e){t.setAjaxIndicator(!0)},onSelectLiClicked:function(t){var e=t.data.self,a=i(t.currentTarget);e.state.dropdown.find("li").each(function(){i(this).removeClass("selected")}),a.addClass("selected"),e.state.selectBox.html(a.text()),e.state.selectedValue=a.attr("data-value"),e.state.$el.val(e.state.selectedValue),e.state.$el.trigger("change")}};i.fn.tinyselect=function(t){return this.each(function(){Object.create(e).init(i(this),t)})}}(jQuery);