/*
 * tinySelect ( http://mcfizh.github.io/tinySelect/ )
 *
 * Licensed under MIT license.
 *
 * @version 3.0.1
 * @author Pekka HarjamÃ¤ki
 */
(s=>{let i={init:function(t,e){t.data("tinySelectObj",this),this.config=s.extend({showSearch:!0,searchCaseSensitive:!0,txtLoading:"Loading...",txtAjaxFailure:"Error...",dataUrl:null,dataParser:null},e),this.state={container:null,selectBox:null,itemContainer:null,searchContainer:null,searchBox:null,$el:null,open:!1,ajaxPending:!1,selectedValue:-1,originalItemData:[],filteredItemData:[]},this.readSelect(t),this.createSelect(t)},createSelect:function(t){this.state.container=s("<div></div>").addClass("tinyselect").css({width:t.css("width")});var e=t.attr("id");e&&0<e.length&&this.state.container.attr("id",e+"_ts"),this.state.selectBox=s("<div></div>").addClass("selectbox").on("click",{self:this},this.onSelectBoxClicked),this.state.container.append(this.state.selectBox),this.state.dropdown=s("<div></div>").addClass("dropdown").hide(),this.state.container.append(this.state.dropdown),this.config.showSearch&&this.createSearch(this.state.dropdown),this.state.itemContainer=s("<ul></ul>").addClass("itemcontainer"),this.state.dropdown.append(this.state.itemContainer),this.createItems(),t.hide().after(this.state.container),this.state.$el=t,s(document).on("click",{self:this},this.onDocumentClicked)},createItems:function(){this.state.itemContainer.empty();for(var t of this.state.filteredItemData){var e=s("<li></li>").text(t.text).addClass("item").attr("data-value",t.val);t.val===this.state.selectedValue&&(this.state.selectBox.html(t.text),e.addClass("selected")),e.on("click",{self:this},this.onSelectLiClicked),this.state.itemContainer.append(e)}},createSearch:function(){this.state.searchContainer=s("<div></div>").addClass("searchcontainer"),this.state.searchBox=s("<input type='text'></input>").addClass("searchbox").on("click",function(t){t.stopPropagation()}).on("keyup",{self:this},this.onSearchKeyPress),this.state.searchContainer.append(s("<span class='searchicon'></span>")),this.state.searchContainer.append(this.state.searchBox),this.state.dropdown.append(this.state.searchContainer)},readSelect:function(t){let e=this;t.find("option").each(function(){var t=s(this);e.state.originalItemData.push({val:t.val(),text:t.text()})}),this.state.filteredItemData=this.state.originalItemData,this.state.selectedValue=t.val()},loadData:function(t){let e=this;e.setAjaxIndicator(!1),s.ajax({url:t,dataType:"json",type:"GET"}).done(function(t){e.onAjaxLoadSuccess(e,t)}).fail(function(){e.onAjaxLoadError(e)})},setAjaxIndicator:function(t){this.state.ajaxPending=!0,this.state.itemContainer.empty(),null!==this.state.searchContainer&&this.state.searchContainer.hide();var e=s("<li></li>");t?e.text(this.config.txtAjaxFailure).addClass("loaderrorindicator"):e.text(this.config.txtLoading).addClass("loadindicator"),this.state.itemContainer.append(e)},onDocumentClicked:function(t){var e=t.data.self;e.state.open&&e.onSelectBoxClicked(t)},onSearchKeyPress:function(t){let e=t.data.self,a=s(t.currentTarget).val();0===(a=e.config.searchCaseSensitive?a:a.toLowerCase()).length?e.state.filteredItemData=e.state.originalItemData:e.state.filteredItemData=e.state.originalItemData.filter(function(t){return e.config.searchCaseSensitive?0<=t.text.indexOf(a):0<=t.text.toLowerCase().indexOf(a)}),e.createItems()},onSelectBoxClicked:function(t){t=t.data.self;t.state.dropdown.is(":animated")||(t.state.open?(t.state.open=!1,t.state.selectBox.removeClass("open"),t.state.dropdown.slideUp(100)):(null!==t.config.dataUrl&&t.loadData(t.config.dataUrl),t.state.open=!0,t.state.selectBox.addClass("open"),t.state.dropdown.slideDown(100)))},onAjaxLoadSuccess:function(e,t){e.state.ajaxPending=!1,null!==e.config.dataParser&&(t=e.config.dataParser(t,e.state.selectedValue)),e.state.$el.empty(),t.forEach(function(t){t.selected&&(e.state.selectedValue=t.val),e.state.$el.append(s("<option></option>").text(t.text).val(t.val))}),e.state.$el.val(e.state.selectedValue),e.state.originalItemData=t,e.state.filteredItemData=t,null!==this.state.searchContainer&&this.state.searchContainer.show(),e.createItems()},onAjaxLoadError:function(t){t.setAjaxIndicator(!0)},onSelectLiClicked:function(t){var e=t.data.self,t=s(t.currentTarget);e.state.dropdown.find("li").each(function(){s(this).removeClass("selected")}),t.addClass("selected"),e.state.selectBox.html(t.text()),e.state.selectedValue=t.attr("data-value"),e.state.$el.val(e.state.selectedValue),e.state.$el.trigger("change")},onChangeDataUrl:function(t){this.config.dataUrl=t}};s.fn.tinyselect=function(a){if(void 0===a||"object"==typeof a)return this.each(function(){var t,e="plugin_tinySelect";s.data(this,e)||((t=Object.create(i)).init(s(this),a),s.data(this,e,t))});if("string"==typeof a&&"setDataUrl"===a){let e=arguments;return this.each(function(){var t=s.data(this,"plugin_tinySelect");t&&arguments[1]&&t.onChangeDataUrl(e[1])})}}})(jQuery);